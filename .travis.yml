matrix:
  include:
    - language: rust
      rust: 1.31.0
      cache: cargo 
      script:
        - cd driver/
        - cargo build --verbose --all
        - cargo test --verbose --all
    - language: python
      python: 3.6
      install:
        - pip install -U -r event_listener/requirements.txt
      script:
        - pytest --cov=event_listener/dfusion_db/ --cov-report term-missing
        - mypy event_listener/dfusion_db/ --ignore-missing-imports --strict
    - language: minimal
      sudo: required
      dist: trusty
      install:
      # Update docker-engine using Ubuntu 'trusty' apt repo
        curl -sSL "https://get.docker.com/gpg" |
        sudo -E apt-key add -
        echo "deb https://apt.dockerproject.org/repo ubuntu-trusty main" |
        sudo tee -a /etc/apt/sources.list
      - sudo apt-get update
        sudo apt-get -o Dpkg::Options::="--force-confdef" \
        -o Dpkg::Options::="--force-confold" --assume-yes install docker-engine
      - docker version
      # Update docker-compose via pip
      - sudo pip install docker-compose
      - docker-compose version
      before_script:
        - git submodule init
        - git submodule update
        - docker-compose up --build -d
      script:
        - cd dex-contracts 
        # running the e2e tests - deposits
        - sh ./../test/e2e-tests-deposit.sh
      after_script:
        - docker-compose down