notifications:
  email:
    - oncall-dfusion@gnosis.io
  if: (branch = master) OR (tag IS present)
if: (branch = master) OR (type = pull_request) OR (tag IS present)
language: rust
rust: stable
env:
  global:
    - CARGO_INCREMENTAL=0
matrix:
  include:
    - stage: "Local and Rinkeby in Parallel"
      name: "Build and Local Testing"
      cache:
        directories:
          - $HOME/.cache/node-gyp
          - $HOME/.cache/yarn
          - $HOME/.cargo/bin
      before_cache:
        - rm -rf "$TRAVIS_HOME/.cargo/registry/src"
      before_install:
        - sudo apt-get update && sudo apt-get install -y python-pip && sudo pip install awscli
        - $(aws ecr get-login --no-include-email --region $AWS_REGION)
        - nvm install 10 && nvm alias default 10 && npm install -g yarn@latest && yarn --version
      install:
        - (cd dex-contracts && yarn --frozen-lockfile && yarn run prepack)
        - ./scripts/setup_contracts.sh
      script:
        - cargo build --locked
        - cargo test -p e2e rinkeby -- --nocapture
